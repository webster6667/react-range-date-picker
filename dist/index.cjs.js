"use strict";var e=require("@babel/runtime/helpers/slicedToArray"),t=require("@babel/runtime/helpers/asyncToGenerator"),n=require("@babel/runtime/helpers/defineProperty"),a=require("@babel/runtime/regenerator"),r=require("react"),l=require("use-immer"),o=require("bem-components-connector"),c=require("date-helper-js");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=i(e),u=i(t),s=i(n),f=i(a),h=i(r);function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&a.firstChild?a.insertBefore(r,a.firstChild):a.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}(".range-date-picker {\n  display: inline-flex;\n  flex-direction: column;\n}\n.range-date-picker__header {\n  display: flex;\n  flex-direction: column;\n}\n.range-date-picker__nav {\n  display: flex;\n}\n.range-date-picker__selected-month {\n  flex-grow: 1;\n  text-align: center;\n}\n.range-date-picker__selected-month span {\n  align-items: center;\n  justify-content: center;\n  margin: 0 2px;\n  font-size: 12px;\n  color: black;\n}\n.range-date-picker__arrow {\n  position: relative;\n  width: 20px;\n  height: 20px;\n  cursor: pointer;\n}\n.range-date-picker__arrow svg {\n  width: 10px;\n  fill: slategrey;\n}\n.range-date-picker__arrow:hover svg {\n  fill: black;\n}\n.range-date-picker__arrow_left svg {\n  transform: rotate(180deg);\n  transform-origin: center;\n}\n.range-date-picker__arrow_left:hover {\n  transform: translateX(-1px);\n}\n.range-date-picker__arrow_right:hover {\n  transform: translateX(1px);\n}\n.range-date-picker__header-row {\n  display: flex;\n}\n.range-date-picker__day-of-week {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 25px;\n  height: 25px;\n  color: silver;\n  font-size: 9px;\n}\n.range-date-picker__table {\n  display: flex;\n  flex-direction: column;\n}\n.range-date-picker__date-row {\n  display: flex;\n}\n.range-date-picker__date-cell {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 25px;\n  height: 25px;\n}\n.range-date-picker__date-cell > span {\n  flex-grow: 1;\n  line-height: 25px;\n  text-align: center;\n  font-size: 12px;\n  cursor: pointer;\n  color: #000;\n}\n.range-date-picker__date-cell_prev,\n.range-date-picker__date-cell_next {\n  color: #a9a9a9;\n}\n.range-date-picker__date-cell_selected {\n  background-color: #cecece;\n}\n.range-date-picker__date-cell_from,\n.range-date-picker__date-cell_to {\n  background-color: #888888;\n}\n");var m=({styles:e={},...t})=>h.default.createElement("svg",p({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 240.823 240.823"},t),h.default.createElement("path",{d:"M183.189 111.816L74.892 3.555c-4.752-4.74-12.451-4.74-17.215 0-4.752 4.74-4.752 12.439 0 17.179l99.707 99.671-99.695 99.671c-4.752 4.74-4.752 12.439 0 17.191 4.752 4.74 12.463 4.74 17.215 0l108.297-108.261c4.68-4.691 4.68-12.511-.012-17.19z"})),g=o.bemClassName("range-date-picker"),v=function(e){var t=e.duration,n=void 0===t?"left":t,a=e.onClick,r=e.children,l=void 0===r?null:r;return h.default.createElement("div",{onClick:a,className:o.elementClassesConcat(g(),"arrow",s.default({},n,!0))},l||h.default.createElement(m,null))},k=function(e){var t=e.dayOfWeekArray,n=(void 0===t?["П","В","С","Ч","П","С","В"]:t).map((function(e,t){return h.default.createElement("span",{className:g("day-of-week"),key:t},e)}));return h.default.createElement("div",{className:g("header-row")},n)},C=function(e){var t=e.openMonth,n=e.dateRange,a=e.setDateRange,r=e.cellContentLayout,l=e.beforeCellClick,i=e.afterCellClick,p=c.getPrevMonth(t),m=c.getNextMonth(t),v=c.getLastDateOfMonth(p),k=c.getDayOfMonthNumber(v),C=c.getFirstDateOfMonth(t),x=c.getLastDateOfMonth(t),y=c.getDayOfWeekNumber(C),_=c.getDayOfWeekNumber(x),b=y?y-1:6,w=c.getDayOfMonthNumber(x),E=_?8-_:0,M=function(e,t,n,a,r){var l=[],i=[],d=0,p=!1,m=!1,v=!1,k=0,C=t.dateFrom,x=t.dateTo,y=t.clickCount;return function(t,_){var b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return Array(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0).fill("").forEach((function(E,M){var D,N=++M,T=w?w+N:N,O=c.getDateByDayOfMonthNumber(_,T),F=null!==C&&c.isDatesEqual(O,C),q=null!==x&&c.isDatesEqual(O,x),R=Boolean(C&&x),B=!!R&&(O>C&&O<x||F||q),L=3===y&&c.isDatesEqual(O,C),Y=x&&2===y&&c.isDatesEqual(O,x),j=L||Y,S=o.elementClassesConcat(g(),"date-cell",(D={},s.default(D,b,Boolean(b)),s.default(D,"selected",B),s.default(D,"from",F),s.default(D,"to",q),s.default(D,"focus",j),D)),z="function"==typeof e?e({monthStatus:t,cellDate:O,selectedDate:null,dateNumber:T}):T;if(B&&++d,F&&(p=!0),q&&(m=!0),i.push(h.default.createElement("div",{key:O.getTime(),className:S,onClick:u.default(f.default.mark((function e(){return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof a){e.next=3;break}return e.next=3,a(O);case 3:if(n((function(e){var t=e.dateFrom,n=e.dateTo,a=e.clickCount,r=e.shouldClearDateToOnThirdClick,l=e.shouldFocusOnLastCellsOfRange,o=c.isDatesEqual(n,O),i=c.isDatesEqual(t,O);switch(a){case 1:e.dateFrom=O,e.clickCount=2;break;case 2:l&&i?(e.dateFrom=O,e.dateTo=n,e.clickCount=3):O<t?(e.dateFrom=O,e.dateTo=t,e.clickCount=r?3:2):(e.dateTo=O,e.clickCount=3),!R&&i&&(e.dateTo=null,e.dateFrom=O,e.clickCount=1);break;case 3:o&&l?(e.dateTo=O,e.clickCount=2):i&&l?(e.dateFrom=O,e.clickCount=1):r?(e.clickCount=2,e.dateTo=null,e.dateFrom=O):O>n?(e.dateFrom=n,e.dateTo=O,e.clickCount=3):(e.dateFrom=O,e.clickCount=2)}})),"function"!=typeof r){e.next=7;break}return e.next=7,r(O);case 7:case"end":return e.stop()}}),e)})))},h.default.createElement("span",null,z))),7===i.length){var A,P="filled",W=Boolean(d),I=v&&!m&&R||!1;if(W&&k++,7===d&&(P="full-filled"),m&&!p&&k>2){var X,G=l.length-1,H=l[G];l[l.length-1]=h.default.createElement("div",{key:G,className:o.elementClassesConcat(g(),"date-row",(X={},s.default(X,P,W),s.default(X,"firstRowBetweenRange",3===k),s.default(X,"penultimateRow",!0),X))},H.props.children)}l.push(h.default.createElement("div",{key:l.length,className:o.elementClassesConcat(g(),"date-row",(A={},s.default(A,P,W),s.default(A,"hasStartDate",p),s.default(A,"hasFinishDate",m),s.default(A,"firstRowBetweenRange",I),A))},i)),i=[],d=0,v=!1,p&&!m&&(v=!0),p=!1,m=!1}})),[l]}}(r,n,a,l,i);M("prev",p,b,"prev",k-b);var D=M("open",t,w),N=d.default(D,1)[0];4===N.length&&(E=E?E+7:14),5===N.length&&(E=E||7);var T=M("next",m,E,"next"),O=d.default(T,1)[0];return h.default.createElement("div",{className:g("table")},O)};module.exports=function(e){var t=e.className,n=void 0===t?"":t,a=e.openMonthDate,i=void 0===a?new Date:a,s=e.value,p=void 0===s?[]:s,m=e.shouldClearDateToOnThirdClick,x=void 0!==m&&m,y=e.shouldFocusOnLastCellsOfRange,_=void 0===y||y,b=e.cellContentLayout,w=void 0===b?null:b,E=e.beforeChangeMonth,M=void 0===E?null:E,D=e.afterChangeMonth,N=void 0===D?null:D,T=e.beforeChangeYear,O=void 0===T?null:T,F=e.afterChangeYear,q=void 0===F?null:F,R=e.beforeCellClick,B=void 0===R?null:R,L=e.afterCellClick,Y=void 0===L?null:L,j=d.default(p,2),S=j[0],z=void 0===S?null:S,A=j[1],P=void 0===A?null:A,W=l.useImmer({clickCount:1,dateFrom:z,dateTo:P,shouldClearDateToOnThirdClick:x,shouldFocusOnLastCellsOfRange:_,dateFromFocus:!1,dateToFocus:!1}),I=d.default(W,2),X=I[0],G=I[1],H=r.useState(i),J=d.default(H,2),K=J[0],Q=J[1],U=o.blockClassesConcat(g(),{firstTheme:!0},n);return h.default.createElement("div",{className:U},h.default.createElement("div",{className:g("header")},function(e){var t=e.openMonth,n=e.setOpenMonth,a=e.beforeChangeMonth,r=e.afterChangeMonth,l=e.beforeChangeYear,o=e.afterChangeYear,i=t.getMonth(),d=c.getMonthNameByMonthIndex(i),s=t.getFullYear(),p=function(){var e=u.default(f.default.mark((function e(i){var d,u;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d="next"===i?c.getNextMonth(t):c.getPrevMonth(t),u=t.getFullYear()!==d.getFullYear(),"function"!=typeof a){e.next=4;break}return e.next=4,a();case 4:if("function"!=typeof l||!u){e.next=7;break}return e.next=7,l();case 7:if(n((function(){return d})),"function"!=typeof r){e.next=11;break}return e.next=11,r();case 11:if("function"!=typeof o||!u){e.next=14;break}return e.next=14,o();case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return h.default.createElement("div",{className:g("nav")},h.default.createElement(v,{duration:"left",onClick:function(){return p("prev")}}),h.default.createElement("div",{className:g("selected-month")},h.default.createElement("span",{className:g("month-name")},d),h.default.createElement("span",{className:g("full-year")},s)),h.default.createElement(v,{duration:"right",onClick:function(){return p("next")}}))}({openMonth:K,setOpenMonth:Q,beforeChangeMonth:M,afterChangeMonth:N,beforeChangeYear:O,afterChangeYear:q}),h.default.createElement(k,null)),C({openMonth:K,dateRange:X,setDateRange:G,cellContentLayout:w,beforeCellClick:B,afterCellClick:Y}))};
